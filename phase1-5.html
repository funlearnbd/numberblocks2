<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Let's Build 1-20!</title>
    <style>
        body {
            background-color: #f0f4f8; 
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            height: 100vh; margin: 0; 
            user-select: none; touch-action: none; overflow: hidden;
            padding: 10px; box-sizing: border-box;
        }

        /* --- START OVERLAY --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 9999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }

        #start-btn {
            font-size: 40px; padding: 20px 60px;
            background: #ff4d4d; color: white;
            border: 4px solid #d63031; border-radius: 20px;
            box-shadow: 0 10px 0 #d63031;
            cursor: pointer; font-family: inherit; font-weight: bold;
            transition: transform 0.1s;
        }
        #start-btn:active { transform: translateY(5px); box-shadow: 0 5px 0 #d63031; }

        /* --- HEADER --- */
        .nav-row {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; max-width: 900px;
            height: 50px; margin-bottom: 5px; z-index: 1000;
        }

        .left-nav { display: flex; gap: 10px; }

        .btn {
            text-decoration: none; font-size: 16px; background: white; 
            padding: 8px 16px; border-radius: 15px; border: 2px solid #ddd; 
            color: #555; font-weight: bold; box-shadow: 0 4px 0 #eee; cursor: pointer;
        }

        #lang-select {
            font-size: 16px; padding: 5px 10px; border-radius: 12px;
            border: 2px solid #ddd; font-weight: bold; color: #555;
            background: white; cursor: pointer;
        }

        #next-btn {
            display: none; padding: 8px 30px; font-size: 18px; 
            color: white; border: none; border-radius: 50px; cursor: pointer; 
            font-weight: bold; border: 2px solid rgba(0,0,0,0.1);
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }
        
        #next-btn.blink { animation: pulseBtn 1s infinite alternate; }
        @keyframes pulseBtn {
            0% { transform: scale(1); filter: brightness(1); }
            100% { transform: scale(1.05); filter: brightness(1.1); box-shadow: 0 0 15px rgba(255,255,0, 0.6); }
        }

        .title-row {
            width: 100%; text-align: center; margin-bottom: 10px; min-height: 40px;
            display: flex; justify-content: center; align-items: center;
        }
        h1 { margin: 0; color: #333; font-size: 26px; white-space: normal; line-height: 1.2; }

        /* --- GAME STAGE --- */
        #game-stage {
            display: flex; justify-content: space-between; align-items: flex-end; 
            width: 100%; max-width: 900px; 
            flex-grow: 1; max-height: 650px;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            padding: 20px 5%; position: relative; box-sizing: border-box; margin-bottom: 20px;
        }

        /* --- SOURCE --- */
        #source-area {
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            width: 140px; height: 240px; 
            border: 3px dashed #ccc; border-radius: 20px;
            background: #fafafa; flex-shrink: 0;
            padding: 10px 0; box-sizing: border-box;
            transition: opacity 0.3s;
        }
        #source-area.locked { opacity: 0.5; pointer-events: none; filter: grayscale(1); }

        .mascot-face { width: 40px; height: 30px; position: relative; flex-shrink: 0; }

        #target-hint {
            font-size: 80px; font-weight: bold; line-height: 1; margin: 0;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
            flex-grow: 1; display: flex; align-items: center; justify-content: center;
        }

        .helper-text { color: #aaa; font-weight: bold; font-size: 14px; text-align: center; margin-bottom: 5px; }
        #spawner { width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }

        /* --- BUILD AREA --- */
        #build-area-container {
            flex-grow: 1; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: flex-end;
            margin-left: 10px;
        }
        #block-holder { position: relative; transition: all 0.3s ease; }

        /* --- BLOCKS --- */
        .unit {
            width: 60px; height: 60px; border-radius: 12px; position: absolute;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.15), 3px 3px 0 rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.15s; cursor: pointer;
            box-sizing: border-box; z-index: 10;
        }
        .unit:active { transform: scale(0.95); }

        .draggable-one { cursor: grab; z-index: 100; position: static; animation: spawnPop 0.4s; }
        .draggable-one:active { cursor: grabbing; transform: scale(1.1); }

        .ghost-slot {
            width: 60px; height: 60px; border: 2px dashed #ddd; border-radius: 12px;
            background: rgba(0,0,0,0.02); position: absolute; box-sizing: border-box;
        }
        .ghost-slot.highlight { background: rgba(255, 77, 77, 0.1); border-color: #ff4d4d; transform: scale(1.05); }

        /* --- COLORS (1-20) --- */
        .c1 { background: #ff4d4d; border: 3px solid #d63031; }
        .c2 { background: #ff9f43; border: 3px solid #e67e22; }
        .c3 { background: #feca57; border: 3px solid #f1c40f; }
        .c4 { background: #00b894; border: 3px solid #00886e; }
        .c5 { background: #48dbfb; border: 3px solid #0abde3; }
        .c6 { background: #a29bfe; border: 3px solid #6c5ce7; }
        .c7 { background: #fd79a8; border: 3px solid #e84393; }
        .c8 { background: #e84393; border: 3px solid #c92876; }
        .c9 { background: #b2bec3; border: 3px solid #636e72; }
        .c10 { background: white; border: 4px solid #ff4d4d; }
        /* New Colors 11-20 */
        .c11 { background: #d63031; border: 3px solid #b71540; } /* Dark Red */
        .c12 { background: #e17055; border: 3px solid #d35400; } /* Burnt Orange */
        .c13 { background: #fdcb6e; border: 3px solid #e1b12c; } /* Mustard */
        .c14 { background: #00cec9; border: 3px solid #00b894; } /* Teal */
        .c15 { background: #74b9ff; border: 3px solid #0984e3; } /* Sky Blue */
        .c16 { background: #6c5ce7; border: 3px solid #4834d4; } /* Deep Purple */
        .c17 { background: #ff7675; border: 3px solid #e056fd; } /* Rose */
        .c18 { background: #55efc4; border: 3px solid #00b894; } /* Mint */
        .c19 { background: #636e72; border: 3px solid #2d3436; } /* Dark Grey */
        .c20 { background: #ffeaa7; border: 3px solid #fdcb6e; } /* Light Gold */

        /* --- FACE --- */
        .face-container { 
            width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 6px;
        }
        .eyes-row { display: flex; justify-content: center; align-items: center; margin-bottom: 2px; }
        .eye { 
            width: 14px; height: 14px; background: white; border-radius: 50%; border: 2px solid #222; 
            position: relative; margin: 0 -1px; z-index: 2;
        }
        .eye::after { 
            content: ''; position: absolute; right: 3px; top: 4px; width: 4px; height: 4px; background: #222; border-radius: 50%; 
        }
        .mouth { width: 16px; height: 6px; border-bottom: 3px solid #222; border-radius: 0 0 10px 10px; }

        #tutorial-hand {
            position: absolute; top: 60%; left: 15%; font-size: 50px; pointer-events: none; z-index: 500;
            animation: moveHand 2s infinite; display: none; opacity: 0.9;
        }

        @keyframes spawnPop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes moveHand { 0% { transform: translate(0,0) rotate(-10deg); opacity:0;} 20%{opacity:1;} 80%{transform: translate(200px, 0) rotate(-10deg); opacity: 0;} 100%{opacity:0;} }
    </style>
</head>
<body>
    
    <div id="start-overlay">
        <h1 style="font-size: 36px; margin-bottom: 30px;">Ready?</h1>
        <button id="start-btn" onclick="initGame()">START ‚ñ∂</button>
    </div>

    <div class="nav-row">
        <div class="left-nav">
            <a href="index.html" class="btn">üè† Home</a>
            <select id="lang-select" onchange="changeLanguage()">
                <option value="en">üá∫üá∏ English</option>
                <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                <option value="bn">üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
            </select>
        </div>
        <button id="next-btn" onclick="nextLevel()">Next ‚ûî</button>
    </div>

    <div class="title-row">
        <h1 id="level-title">Let's make Number 1!</h1>
    </div>

    <div id="game-stage">
        <div id="tutorial-hand">üëâ</div>
        <div id="source-area">
            <div class="mascot-face">
                <div class="face-container">
                    <div class="eyes-row"><div class="eye"></div><div class="eye"></div></div>
                    <div class="mouth"></div>
                </div>
            </div>
            <div id="target-hint">1</div>
            <div class="helper-text">Drag Me!</div>
            <div id="spawner"></div>
        </div>
        <div id="build-area-container">
            <div id="block-holder"></div>
        </div>
    </div>

    <script>
        // CONFIG
        let currentLang = 'en'; 
        let isInputLocked = true; 
        let currentLevel = 1;
        let blocksPlaced = 0;
        let isComplete = false;
        const MAX_LEVEL = 20;
        const BLOCK_SIZE = 60;
        const GAP = 2; 

        // TEXT DATA
        const UI_TEXT = {
            en: { title: "Let's make Number", drag: "Drag Me!", next: "Next ‚ûî" },
            ar: { title: "ŸÑŸÜÿ®ŸÜŸä ÿßŸÑÿ±ŸÇŸÖ", drag: "ÿßÿ≥ÿ≠ÿ®ŸÜŸä", next: "ÿßŸÑÿ™ÿßŸÑŸä ‚¨Ö" },
            bn: { title: "‡¶ö‡¶≤‡ßã ‡¶¨‡¶æ‡¶®‡¶æ‡¶á ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ", drag: "‡¶ü‡ßá‡¶®‡ßá ‡¶Ü‡¶®‡ßã", next: "‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‚ûî" }
        };

        const SUCCESS_MESSAGES = {
            en: ["Excellent! You made number {n}!", "Great Job! Number {n} is complete!", "Amazing work! That is number {n}!"],
            ar: ["ŸÖŸÖÿ™ÿßÿ≤! ŸÑŸÇÿØ ÿµŸÜÿπÿ™ ÿßŸÑÿ±ŸÇŸÖ {n}!", "ÿπŸÖŸÑ ÿ±ÿßÿ¶ÿπ! ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ±ŸÇŸÖ {n}!", "ŸÖÿ∞ŸáŸÑ! Ÿáÿ∞ÿß ŸáŸà ÿßŸÑÿ±ŸÇŸÖ {n}!"],
            bn: ["‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞! ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ {n} ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ!", "‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£ ‡¶ï‡¶æ‡¶ú! ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ {n} ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£! ‡¶è‡¶ü‡¶æ ‡¶π‡¶≤‡ßã ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ {n}!"]
        };

        // NUMBERS 1-20
        const NUMBER_DATA = {
            1: { color: '#ff4d4d', en: '1', ar: 'Ÿ°', bn: '‡ßß' },
            2: { color: '#ff9f43', en: '2', ar: 'Ÿ¢', bn: '‡ß®' },
            3: { color: '#feca57', en: '3', ar: 'Ÿ£', bn: '‡ß©' },
            4: { color: '#00b894', en: '4', ar: 'Ÿ§', bn: '‡ß™' },
            5: { color: '#48dbfb', en: '5', ar: 'Ÿ•', bn: '‡ß´' },
            6: { color: '#a29bfe', en: '6', ar: 'Ÿ¶', bn: '‡ß¨' },
            7: { color: '#fd79a8', en: '7', ar: 'Ÿß', bn: '‡ß≠' },
            8: { color: '#e84393', en: '8', ar: 'Ÿ®', bn: '‡ßÆ' },
            9: { color: '#b2bec3', en: '9', ar: 'Ÿ©', bn: '‡ßØ' },
            10: { color: '#ffffff', en: '10', ar: 'Ÿ°Ÿ†', bn: '‡ßß‡ß¶' },
            11: { color: '#d63031', en: '11', ar: 'Ÿ°Ÿ°', bn: '‡ßß‡ßß' },
            12: { color: '#e17055', en: '12', ar: 'Ÿ°Ÿ¢', bn: '‡ßß‡ß®' },
            13: { color: '#fdcb6e', en: '13', ar: 'Ÿ°Ÿ£', bn: '‡ßß‡ß©' },
            14: { color: '#00cec9', en: '14', ar: 'Ÿ°Ÿ§', bn: '‡ßß‡ß™' },
            15: { color: '#74b9ff', en: '15', ar: 'Ÿ°Ÿ•', bn: '‡ßß‡ß´' },
            16: { color: '#6c5ce7', en: '16', ar: 'Ÿ°Ÿ¶', bn: '‡ßß‡ß¨' },
            17: { color: '#ff7675', en: '17', ar: 'Ÿ°Ÿß', bn: '‡ßß‡ß≠' },
            18: { color: '#55efc4', en: '18', ar: 'Ÿ°Ÿ®', bn: '‡ßß‡ßÆ' },
            19: { color: '#636e72', en: '19', ar: 'Ÿ°Ÿ©', bn: '‡ßß‡ßØ' },
            20: { color: '#ffeaa7', en: '20', ar: 'Ÿ¢Ÿ†', bn: '‡ß®‡ß¶' }
        };

        // DOM ELEMENTS
        const spawner = document.getElementById('spawner');
        const sourceArea = document.getElementById('source-area');
        const holder = document.getElementById('block-holder');
        const title = document.getElementById('level-title');
        const nextBtn = document.getElementById('next-btn');
        const hand = document.getElementById('tutorial-hand');
        const targetHint = document.getElementById('target-hint');
        const helperText = document.querySelector('.helper-text');

        function initGame() {
            document.getElementById('start-overlay').style.display = 'none';
            startLevel(1);
        }

        // --- GRID & SHAPE LOGIC (1-20) ---
        function getHolderSize(n) {
            let cols, rows;
            // 1-10 (Standard)
            if (n === 1) { cols = 1; rows = 1; }
            else if (n === 2) { cols = 2; rows = 1; }
            else if (n === 3 || n === 4) { cols = 2; rows = 2; }
            else if (n === 5 || n === 6) { cols = 2; rows = 3; }
            else if (n === 7 || n === 8) { cols = 2; rows = 4; }
            else if (n === 9) { cols = 3; rows = 3; }
            else if (n === 10) { cols = 2; rows = 5; }
            // 11-20 (Extended)
            else if (n === 11) { cols = 2; rows = 6; } // 1 top, 2x5 bottom
            else if (n === 12) { cols = 3; rows = 4; } // Rectangle 3x4
            else if (n === 13) { cols = 3; rows = 5; } // 1 top, 12 bottom
            else if (n === 14) { cols = 2; rows = 7; } // Rectangle 2x7
            else if (n === 15) { cols = 3; rows = 5; } // Rectangle 3x5
            else if (n === 16) { cols = 4; rows = 4; } // Square 4x4
            else if (n === 17) { cols = 4; rows = 5; } // 1 top, 16 bottom
            else if (n === 18) { cols = 3; rows = 6; } // Rectangle 3x6
            else if (n === 19) { cols = 3; rows = 7; } // 1 top, 18 bottom
            else if (n === 20) { cols = 4; rows = 5; } // Rectangle 4x5

            return { width: cols * BLOCK_SIZE + (cols-1)*GAP, height: rows * BLOCK_SIZE + (rows-1)*GAP };
        }

        function getTargetCoordinates(number, index) {
            let row, col;
            // 1-10 Logic
            if (number === 2) { row = 0; col = index; }
            else if ([3,5,7].includes(number)) {
                // Odd Stacks (1 top left, rest 2 cols)
                // Calculate height of the "body"
                const bodyRows = Math.floor((number-1)/2);
                if(index === number-1) { row = bodyRows; col = 0; } // Top block
                else { row = Math.floor(index/2); col = index%2; }
            }
            else if (number === 9) { row = Math.floor(index/3); col = index%3; }
            else if (number === 1) { row = 0; col = 0; }
            else if ([4,6,8,10].includes(number)) { row = Math.floor(index/2); col = index%2; }
            
            // 11-20 Logic
            else if (number === 11) { // 1 on top of 10
                if(index === 10) { row = 5; col = 0; }
                else { row = Math.floor(index/2); col = index%2; }
            }
            else if (number === 12) { row = Math.floor(index/3); col = index%3; }
            else if (number === 13) { // 1 on top of 12 (3x4)
                if(index === 12) { row = 4; col = 0; }
                else { row = Math.floor(index/3); col = index%3; }
            }
            else if (number === 14) { row = Math.floor(index/2); col = index%2; }
            else if (number === 15) { row = Math.floor(index/3); col = index%3; }
            else if (number === 16) { row = Math.floor(index/4); col = index%4; }
            else if (number === 17) { // 1 on top of 16
                if(index === 16) { row = 4; col = 0; }
                else { row = Math.floor(index/4); col = index%4; }
            }
            else if (number === 18) { row = Math.floor(index/3); col = index%3; }
            else if (number === 19) { // 1 on top of 18
                if(index === 18) { row = 6; col = 0; }
                else { row = Math.floor(index/3); col = index%3; }
            }
            else if (number === 20) { row = Math.floor(index/4); col = index%4; }

            return { bottom: row * (BLOCK_SIZE + GAP), left: col * (BLOCK_SIZE + GAP) };
        }

        function getHeadIndex(num) {
            // Returns the index of the block that gets the face
            if(num === 1) return 0;
            if(num === 2) return 0; // Left
            if([3,5,7,11,13,17,19].includes(num)) return num - 1; // Top-most solitary block
            if(num === 9) return 6; // Top-Left of 3x3
            if(num === 12) return 9; // Top-Left of 3x4
            if(num === 15) return 12; // Top-Left of 3x5
            if(num === 16) return 12; // Top-Left of 4x4
            if(num === 18) return 15; // Top-Left of 3x6
            if(num === 20) return 16; // Top-Left of 4x5
            // Standard 2-col evens (4,6,8,10,14)
            if([4,6,8,10,14].includes(num)) return num - 2; 
            return 0;
        }

        // --- GAMEPLAY FUNCTIONS ---
        function getSuccessMessage(lang, num) {
            const templates = SUCCESS_MESSAGES[lang];
            return templates[Math.floor(Math.random() * templates.length)].replace("{n}", NUMBER_DATA[num][lang]);
        }

        function speak(text, callback) {
            if('speechSynthesis' in window){
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(text);
                if(currentLang === 'ar') msg.lang = 'ar-SA';
                else if(currentLang === 'bn') msg.lang = 'bn-BD';
                else msg.lang = 'en-US';
                msg.pitch = 1.3; msg.rate = 1.0;
                if(callback) msg.onend = callback;
                window.speechSynthesis.speak(msg);
            } else { if(callback) callback(); }
        }

        function changeLanguage() {
            currentLang = document.getElementById('lang-select').value;
            updateUIText();
        }

        function updateUIText() {
            title.innerText = `${UI_TEXT[currentLang].title} ${NUMBER_DATA[currentLevel][currentLang]}!`;
            targetHint.innerText = NUMBER_DATA[currentLevel][currentLang];
            helperText.innerText = UI_TEXT[currentLang].drag;
            nextBtn.innerText = UI_TEXT[currentLang].next;
        }

        function startLevel(num) {
            currentLevel = num;
            blocksPlaced = 0;
            isComplete = false;
            nextBtn.style.display = 'none';
            nextBtn.classList.remove('blink'); 
            hand.style.display = 'none'; 
            isInputLocked = true;
            sourceArea.classList.add('locked');

            updateUIText();
            targetHint.style.color = (num === 10) ? '#aaa' : NUMBER_DATA[num].color;

            holder.innerHTML = '';
            const size = getHolderSize(num);
            holder.style.width = size.width + 'px';
            holder.style.height = size.height + 'px';

            for (let i = 0; i < num; i++) {
                const slot = document.createElement('div');
                slot.className = 'ghost-slot';
                const pos = getTargetCoordinates(num, i);
                slot.style.bottom = `${pos.bottom}px`;
                slot.style.left = `${pos.left}px`;
                slot.dataset.index = i;
                holder.appendChild(slot);
            }

            createDraggableOne();

            speak(NUMBER_DATA[num][currentLang], () => {
                setTimeout(() => {
                    const phrase = `${UI_TEXT[currentLang].title} ${NUMBER_DATA[num][currentLang]}!`;
                    speak(phrase, () => {
                        isInputLocked = false;
                        sourceArea.classList.remove('locked');
                        if(num <= 2) hand.style.display = 'block';
                    });
                }, 500);
            });
        }

        function createDraggableOne() {
            if(isComplete) return;
            spawner.innerHTML = ''; 
            const unit = document.createElement('div');
            unit.className = 'unit c1 draggable-one'; 
            unit.setAttribute('draggable', 'true');
            unit.addEventListener('touchstart', handleTouchStart, {passive: false});
            unit.addEventListener('touchmove', handleTouchMove, {passive: false});
            unit.addEventListener('touchend', handleTouchEnd);
            unit.addEventListener('dragstart', (e) => {
                if(isInputLocked) { e.preventDefault(); return; }
                e.dataTransfer.setData('text/plain', 'red-one');
                hand.style.display = 'none'; 
            });
            spawner.appendChild(unit);
        }

        // TOUCH HANDLING
        let dragItem = null, touchOffsetX = 0, touchOffsetY = 0;
        function handleTouchStart(e) {
            if(isInputLocked) return;
            e.preventDefault();
            const touch = e.touches[0];
            dragItem = e.target.closest('.draggable-one');
            if(!dragItem) return;
            hand.style.display = 'none';
            const rect = dragItem.getBoundingClientRect();
            touchOffsetX = touch.clientX - rect.left;
            touchOffsetY = touch.clientY - rect.top;
            dragItem.style.position = 'fixed';
            dragItem.style.zIndex = 1000;
            dragItem.style.width = BLOCK_SIZE + 'px';
            dragItem.style.height = BLOCK_SIZE + 'px';
            moveItem(touch.clientX, touch.clientY);
        }
        function handleTouchMove(e) { if(!dragItem) return; e.preventDefault(); moveItem(e.touches[0].clientX, e.touches[0].clientY); }
        function moveItem(x, y) { dragItem.style.left = (x - touchOffsetX) + 'px'; dragItem.style.top = (y - touchOffsetY) + 'px'; }
        function handleTouchEnd(e) {
            if(!dragItem) return;
            dragItem.style.display = 'none'; 
            const elem = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            dragItem.style.display = 'flex'; 
            const slot = elem ? elem.closest('.ghost-slot') : null;
            if (slot && !slot.hasChildNodes()) fillSlot(slot);
            else createDraggableOne();
            dragItem = null;
        }

        holder.addEventListener('dragover', (e) => { e.preventDefault(); if (e.target.classList.contains('ghost-slot')) e.target.classList.add('highlight'); });
        holder.addEventListener('dragleave', (e) => { if (e.target.classList.contains('ghost-slot')) e.target.classList.remove('highlight'); });
        holder.addEventListener('drop', (e) => { e.preventDefault(); if (e.target.classList.contains('ghost-slot')) fillSlot(e.target); });

        function fillSlot(slot) {
            if(isInputLocked) return;
            slot.classList.remove('ghost-slot', 'highlight');
            slot.classList.add('unit', 'c1'); 
            slot.innerHTML = ''; 
            slot.addEventListener('click', () => { 
                speak(NUMBER_DATA[1][currentLang]); 
                slot.style.transform = "scale(1.2)"; setTimeout(() => slot.style.transform = "scale(1)", 150); 
            });
            blocksPlaced++;
            speak(NUMBER_DATA[blocksPlaced][currentLang]); 
            
            if (blocksPlaced === currentLevel) {
                isComplete = true; isInputLocked = true; 
                setTimeout(transformCharacter, 600);
            } else { setTimeout(createDraggableOne, 50); }
        }

        function transformCharacter() {
            spawner.innerHTML = ''; 
            const blocks = holder.querySelectorAll('.unit');
            const headIndex = getHeadIndex(currentLevel);

            blocks.forEach((b, i) => {
                b.className = `unit c${currentLevel}`;
                if (i === headIndex) b.innerHTML = `<div class="face-container"><div class="eyes-row"><div class="eye"></div><div class="eye"></div></div><div class="mouth"></div></div>`;
                b.style.animation = "popIn 0.5s ease-out";
            });

            speak(getSuccessMessage(currentLang, currentLevel), () => {
                nextBtn.style.display = 'block';
                nextBtn.style.backgroundColor = NUMBER_DATA[currentLevel].color;
                nextBtn.style.color = [3,10,13,20].includes(currentLevel) ? '#555' : 'white'; 
                nextBtn.classList.add('blink'); 
            });
        }

        function nextLevel() {
            if (currentLevel < MAX_LEVEL) startLevel(currentLevel + 1);
            else alert("Complete!"); 
        }
    </script>
</body>
</html>