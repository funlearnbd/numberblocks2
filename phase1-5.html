<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Let's Build (Horizontal)</title>
    <style>
        body {
            background-color: #f0f4f8; 
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; 
            user-select: none; touch-action: none; overflow: hidden;
            padding: 5px; box-sizing: border-box;
        }

        /* --- START OVERLAY --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #start-btn {
            font-size: 30px; padding: 15px 50px;
            background: #ff4d4d; color: white; border: 4px solid #d63031; border-radius: 20px;
            cursor: pointer; font-weight: bold;
        }

        /* --- TOP BAR (Nav & Title) --- */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            width: 98%; height: 50px; margin-bottom: 5px;
        }
        
        .left-controls { display: flex; align-items: center; gap: 10px; }
        
        .btn {
            text-decoration: none; font-size: 14px; background: white; 
            padding: 5px 15px; border-radius: 12px; border: 2px solid #ddd; 
            color: #555; font-weight: bold; cursor: pointer;
        }

        h1 { margin: 0; color: #333; font-size: 24px; }

        /* --- MAIN STAGE (Horizontal Layout) --- */
        #game-stage {
            display: flex; 
            flex-direction: row; /* Horizontal! */
            align-items: flex-end; /* Align bottoms */
            width: 98%; flex-grow: 1; /* Fill screen */
            background: white; border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); 
            padding: 20px; 
            position: relative; box-sizing: border-box; 
        }

        /* --- LEFT SIDE: SOURCE --- */
        #source-area {
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            width: 120px; height: 100%; max-height: 250px;
            border-right: 2px dashed #eee; /* Divider instead of box */
            padding-right: 20px; margin-right: 20px;
        }

        .mascot-face { width: 40px; height: 30px; position: relative; }
        
        #target-hint {
            font-size: 60px; font-weight: bold; line-height: 1; 
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }

        .helper-text { color: #aaa; font-weight: bold; font-size: 14px; }
        
        #spawner { width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; }

        /* --- RIGHT SIDE: BUILD AREA --- */
        #build-area-container {
            flex-grow: 1; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: flex-end; /* Build from bottom center */
            padding-bottom: 10px;
        }
        
        #block-holder { position: relative; transition: all 0.3s ease; }

        /* --- BLOCKS (Slightly smaller for 1-20 fit) --- */
        .unit {
            width: 50px; height: 50px; /* Reduced from 60 to fit 20 */
            border-radius: 10px; position: absolute;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.15), 2px 2px 0 rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.15s; cursor: pointer; box-sizing: border-box; z-index: 10;
        }
        .unit:active { transform: scale(0.95); }

        .draggable-one { cursor: grab; z-index: 100; position: static; animation: spawnPop 0.4s; }

        .ghost-slot {
            width: 50px; height: 50px; 
            border: 2px dashed #ddd; border-radius: 10px;
            background: rgba(0,0,0,0.02); position: absolute; box-sizing: border-box;
        }
        .ghost-slot.highlight { background: rgba(255, 77, 77, 0.1); border-color: #ff4d4d; transform: scale(1.05); }

        /* --- NEXT BUTTON (Top Right) --- */
        #next-btn {
            display: none; padding: 8px 25px; font-size: 16px; 
            color: white; border: none; border-radius: 50px; cursor: pointer; 
            font-weight: bold; box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        #next-btn.blink { animation: pulseBtn 1s infinite alternate; }

        /* COLORS 1-20 */
        .c1 { background: #ff4d4d; border: 3px solid #d63031; }
        .c2 { background: #ff9f43; border: 3px solid #e67e22; }
        .c3 { background: #feca57; border: 3px solid #f1c40f; }
        .c4 { background: #00b894; border: 3px solid #00886e; }
        .c5 { background: #48dbfb; border: 3px solid #0abde3; }
        .c6 { background: #a29bfe; border: 3px solid #6c5ce7; }
        .c7 { background: #fd79a8; border: 3px solid #e84393; }
        .c8 { background: #e84393; border: 3px solid #c92876; }
        .c9 { background: #b2bec3; border: 3px solid #636e72; }
        .c10 { background: white; border: 3px solid #ff4d4d; }
        .c11 { background: #d63031; border: 3px solid #b71540; }
        .c12 { background: #e17055; border: 3px solid #d35400; }
        .c13 { background: #fdcb6e; border: 3px solid #e1b12c; }
        .c14 { background: #00cec9; border: 3px solid #00b894; }
        .c15 { background: #74b9ff; border: 3px solid #0984e3; }
        .c16 { background: #6c5ce7; border: 3px solid #4834d4; }
        .c17 { background: #ff7675; border: 3px solid #e056fd; }
        .c18 { background: #55efc4; border: 3px solid #00b894; }
        .c19 { background: #636e72; border: 3px solid #2d3436; }
        .c20 { background: #ffeaa7; border: 3px solid #fdcb6e; }

        /* FACE */
        .face-container { width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 4px; }
        .eyes-row { display: flex; justify-content: center; margin-bottom: 1px; }
        .eye { width: 12px; height: 12px; background: white; border-radius: 50%; border: 2px solid #222; position: relative; margin: 0 -1px; }
        .eye::after { content: ''; position: absolute; right: 2px; top: 3px; width: 3px; height: 3px; background: #222; border-radius: 50%; }
        .mouth { width: 14px; height: 5px; border-bottom: 2px solid #222; border-radius: 0 0 10px 10px; }

        #tutorial-hand { position: absolute; bottom: 20px; left: 100px; font-size: 50px; pointer-events: none; z-index: 500; animation: moveHand 2s infinite; display: none; opacity: 0.9; }
        @keyframes spawnPop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes moveHand { 0% { transform: translate(0,0) rotate(-10deg); opacity:0;} 20%{opacity:1;} 80%{transform: translate(150px, -50px) rotate(-10deg); opacity: 0;} 100%{opacity:0;} }
    </style>
</head>
<body>
    
    <div id="start-overlay">
        <button id="start-btn" onclick="initGame()">PLAY ‚ñ∂</button>
    </div>

    <div class="top-bar">
        <div class="left-controls">
            <a href="index.html" class="btn">üè† Home</a>
            <select class="btn" id="lang-select" onchange="changeLanguage()">
                <option value="en">üá∫üá∏ EN</option>
                <option value="ar">üá∏üá¶ AR</option>
                <option value="bn">üáßüá© BN</option>
            </select>
        </div>
        <h1 id="level-title">Let's Build!</h1>
        <button id="next-btn" onclick="nextLevel()">Next ‚ûî</button>
    </div>

    <div id="game-stage">
        
        <div id="tutorial-hand">üëâ</div>

        <div id="source-area">
            <div class="mascot-face">
                <div class="face-container">
                    <div class="eyes-row"><div class="eye"></div><div class="eye"></div></div>
                    <div class="mouth"></div>
                </div>
            </div>
            
            <div id="target-hint">1</div>
            <div class="helper-text">Drag Me!</div>
            <div id="spawner"></div>
        </div>

        <div id="build-area-container">
            <div id="block-holder"></div>
        </div>
    </div>

    <script>
        // CONFIG
        let currentLang = 'en'; 
        let isInputLocked = true; 
        let currentLevel = 1;
        let blocksPlaced = 0;
        let isComplete = false;
        
        const MAX_LEVEL = 20;
        const BLOCK_SIZE = 50; // Smaller for Landscape fitting
        const GAP = 2; 

        // TEXT
        const UI_TEXT = {
            en: { title: "Let's make Number", drag: "Drag Me!", next: "Next ‚ûî" },
            ar: { title: "ŸÑŸÜÿ®ŸÜŸä ÿßŸÑÿ±ŸÇŸÖ", drag: "ÿßÿ≥ÿ≠ÿ®ŸÜŸä", next: "ÿßŸÑÿ™ÿßŸÑŸä ‚¨Ö" },
            bn: { title: "‡¶ö‡¶≤‡ßã ‡¶¨‡¶æ‡¶®‡¶æ‡¶á ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ", drag: "‡¶ü‡ßá‡¶®‡ßá ‡¶Ü‡¶®‡ßã", next: "‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‚ûî" }
        };

        const SUCCESS_MESSAGES = {
            en: ["Excellent!", "Great Job!", "Amazing!"],
            ar: ["ŸÖŸÖÿ™ÿßÿ≤!", "ÿπŸÖŸÑ ÿ±ÿßÿ¶ÿπ!", "ŸÖÿ∞ŸáŸÑ!"],
            bn: ["‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞!", "‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£ ‡¶ï‡¶æ‡¶ú!", "‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£!"]
        };

        // DATA 1-20
        const NUMBER_DATA = {
            1: { color: '#ff4d4d', en: '1', ar: 'Ÿ°', bn: '‡ßß' },
            2: { color: '#ff9f43', en: '2', ar: 'Ÿ¢', bn: '‡ß®' },
            3: { color: '#feca57', en: '3', ar: 'Ÿ£', bn: '‡ß©' },
            4: { color: '#00b894', en: '4', ar: 'Ÿ§', bn: '‡ß™' },
            5: { color: '#48dbfb', en: '5', ar: 'Ÿ•', bn: '‡ß´' },
            6: { color: '#a29bfe', en: '6', ar: 'Ÿ¶', bn: '‡ß¨' },
            7: { color: '#fd79a8', en: '7', ar: 'Ÿß', bn: '‡ß≠' },
            8: { color: '#e84393', en: '8', ar: 'Ÿ®', bn: '‡ßÆ' },
            9: { color: '#b2bec3', en: '9', ar: 'Ÿ©', bn: '‡ßØ' },
            10: { color: '#ffffff', en: '10', ar: 'Ÿ°Ÿ†', bn: '‡ßß‡ß¶' },
            11: { color: '#d63031', en: '11', ar: 'Ÿ°Ÿ°', bn: '‡ßß‡ßß' },
            12: { color: '#e17055', en: '12', ar: 'Ÿ°Ÿ¢', bn: '‡ßß‡ß®' },
            13: { color: '#fdcb6e', en: '13', ar: 'Ÿ°Ÿ£', bn: '‡ßß‡ß©' },
            14: { color: '#00cec9', en: '14', ar: 'Ÿ°Ÿ§', bn: '‡ßß‡ß™' },
            15: { color: '#74b9ff', en: '15', ar: 'Ÿ°Ÿ•', bn: '‡ßß‡ß´' },
            16: { color: '#6c5ce7', en: '16', ar: 'Ÿ°Ÿ¶', bn: '‡ßß‡ß¨' },
            17: { color: '#ff7675', en: '17', ar: 'Ÿ°Ÿß', bn: '‡ßß‡ß≠' },
            18: { color: '#55efc4', en: '18', ar: 'Ÿ°Ÿ®', bn: '‡ßß‡ßÆ' },
            19: { color: '#636e72', en: '19', ar: 'Ÿ°Ÿ©', bn: '‡ßß‡ßØ' },
            20: { color: '#ffeaa7', en: '20', ar: 'Ÿ¢Ÿ†', bn: '‡ß®‡ß¶' }
        };

        const spawner = document.getElementById('spawner');
        const sourceArea = document.getElementById('source-area');
        const holder = document.getElementById('block-holder');
        const title = document.getElementById('level-title');
        const nextBtn = document.getElementById('next-btn');
        const hand = document.getElementById('tutorial-hand');
        const targetHint = document.getElementById('target-hint');
        const helperText = document.querySelector('.helper-text');

        function initGame() {
            document.getElementById('start-overlay').style.display = 'none';
            startLevel(1);
        }

        function speak(text, callback) {
            let safety = setTimeout(() => { if(callback) callback(); }, 2000);
            if('speechSynthesis' in window){
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(text);
                msg.lang = currentLang === 'ar' ? 'ar-SA' : (currentLang === 'bn' ? 'bn-BD' : 'en-US');
                msg.pitch = 1.3; 
                msg.onend = () => { clearTimeout(safety); if(callback) callback(); };
                msg.onerror = () => { clearTimeout(safety); if(callback) callback(); };
                window.speechSynthesis.speak(msg);
            } else { clearTimeout(safety); if(callback) callback(); }
        }

        function changeLanguage() {
            currentLang = document.getElementById('lang-select').value;
            updateUIText();
        }

        function updateUIText() {
            title.innerText = `${UI_TEXT[currentLang].title} ${NUMBER_DATA[currentLevel][currentLang]}!`;
            targetHint.innerText = NUMBER_DATA[currentLevel][currentLang];
            helperText.innerText = UI_TEXT[currentLang].drag;
            nextBtn.innerText = UI_TEXT[currentLang].next;
        }

        // --- HORIZONTAL/WIDE SHAPE LOGIC (1-20) ---
        function getHolderSize(n) {
            let cols, rows;
            // 1-10 (Standard logic)
            if(n==1) {cols=1;rows=1;} else if(n==2) {cols=2;rows=1;}
            else if(n<=4) {cols=2;rows=2;} else if(n<=6) {cols=2;rows=3;}
            else if(n<=8) {cols=2;rows=4;} else if(n==9) {cols=3;rows=3;}
            else if(n==10) {cols=2;rows=5;}
            // 11-20 (Wide Logic for Landscape)
            else if(n==11) {cols=3;rows=4;} // 1 top, 10 rect
            else if(n==12) {cols=4;rows=3;} // 4x3 Rect
            else if(n==13) {cols=4;rows=4;} // 1 top, 12 rect
            else if(n==14) {cols=7;rows=2;} // 7x2 Wide Rect
            else if(n==15) {cols=5;rows=3;} // 5x3 Wide Rect
            else if(n==16) {cols=4;rows=4;} // 4x4 Square
            else if(n==17) {cols=4;rows=5;} // 1 top, 16 sq
            else if(n==18) {cols=6;rows=3;} // 6x3 Rect
            else if(n==19) {cols=6;rows=4;} // 1 top, 18 rect
            else if(n==20) {cols=5;rows=4;} // 5x4 Rect

            return { width: cols * BLOCK_SIZE + (cols-1)*GAP, height: rows * BLOCK_SIZE + (rows-1)*GAP };
        }

        function getTargetCoordinates(number, index) {
            let row, col;
            // 1-10 Coordinates (unchanged logic)
            if(number <= 10) {
                if (number === 2) { row = 0; col = index; }
                else if ([3,5,7].includes(number)) {
                    if(index === number-1) { row = Math.floor((number-1)/2); col = 0; }
                    else { row = Math.floor(index/2); col = index%2; }
                }
                else if (number === 9) { row = Math.floor(index/3); col = index%3; }
                else if (number === 1) { row = 0; col = 0; }
                else { row = Math.floor(index/2); col = index%2; }
            } 
            // 11-20 Coordinates (Wide Logic)
            else {
                // Odd numbers (11, 13, 15...) have 1 extra on top
                const isOdd = number % 2 !== 0;
                let bodySize = isOdd ? number - 1 : number;
                let cols; 
                
                // Define width for body
                if(bodySize === 10) cols = 5; // 2 rows
                else if(bodySize === 12) cols = 4;
                else if(bodySize === 14) cols = 7;
                else if(bodySize === 15) cols = 5; // Wait 15 is odd
                else if(bodySize === 16) cols = 4;
                else if(bodySize === 18) cols = 6;
                else if(bodySize === 20) cols = 5;

                // Handle Number 15 (Wide 5x3)
                if(number === 15) cols = 5;

                if(isOdd && index === number-1) {
                    // Top Block
                    row = Math.ceil(bodySize/cols); col = 0;
                } else {
                    // Body Blocks
                    row = Math.floor(index/cols); col = index%cols;
                }
            }
            return { bottom: row * (BLOCK_SIZE + GAP), left: col * (BLOCK_SIZE + GAP) };
        }

        function getHeadIndex(num) {
            if(num<=2) return 0;
            if([3,5,7].includes(num)) return num-1;
            if(num==9) return 6;
            if(num<=10) return num-2;
            
            // 11-20
            if(num%2 !== 0) return num-1; // Odds (top block)
            if(num==12) return 8; // Top Left (4x3) -> index 8 (row 2, col 0)
            if(num==14) return 7; // Top Left (7x2) -> index 7
            if(num==16) return 12; 
            if(num==18) return 12;
            if(num==20) return 15;
            return 0;
        }

        function startLevel(num) {
            currentLevel = num; blocksPlaced = 0; isComplete = false;
            nextBtn.style.display = 'none'; nextBtn.classList.remove('blink'); 
            hand.style.display = 'none'; 
            isInputLocked = true; sourceArea.style.opacity = 0.5;

            updateUIText();
            targetHint.style.color = (num === 10 || num === 20) ? '#aaa' : NUMBER_DATA[num].color;

            holder.innerHTML = '';
            const size = getHolderSize(num);
            holder.style.width = size.width + 'px';
            holder.style.height = size.height + 'px';

            for (let i = 0; i < num; i++) {
                const slot = document.createElement('div');
                slot.className = 'ghost-slot';
                const pos = getTargetCoordinates(num, i);
                slot.style.bottom = `${pos.bottom}px`;
                slot.style.left = `${pos.left}px`;
                slot.dataset.index = i;
                holder.appendChild(slot);
            }

            createDraggableOne();

            speak(NUMBER_DATA[num][currentLang], () => {
                setTimeout(() => {
                    speak(`${UI_TEXT[currentLang].title} ${NUMBER_DATA[num][currentLang]}!`, () => {
                        isInputLocked = false; sourceArea.style.opacity = 1;
                        if(num <= 2) hand.style.display = 'block';
                    });
                }, 400);
            });
        }

        // DRAG & DROP LOGIC
        function createDraggableOne() {
            if(isComplete) return;
            spawner.innerHTML = ''; 
            const unit = document.createElement('div');
            unit.className = 'unit c1 draggable-one'; 
            unit.setAttribute('draggable', 'true');
            // MOUSE
            unit.addEventListener('dragstart', (e) => {
                if(isInputLocked) { e.preventDefault(); return; }
                e.dataTransfer.setData('text', 'red-one'); hand.style.display = 'none';
            });
            // TOUCH
            unit.addEventListener('touchstart', handleTouchStart, {passive:false});
            unit.addEventListener('touchmove', handleTouchMove, {passive:false});
            unit.addEventListener('touchend', handleTouchEnd);
            spawner.appendChild(unit);
        }

        let dragItem=null, tX=0, tY=0;
        function handleTouchStart(e) {
            if(isInputLocked) return; e.preventDefault();
            dragItem=e.target.closest('.draggable-one'); if(!dragItem)return;
            hand.style.display='none'; const r=dragItem.getBoundingClientRect();
            tX=e.touches[0].clientX-r.left; tY=e.touches[0].clientY-r.top;
            dragItem.style.position='fixed'; dragItem.style.zIndex=999;
            dragItem.style.width=BLOCK_SIZE+'px'; dragItem.style.height=BLOCK_SIZE+'px';
            moveItem(e.touches[0].clientX, e.touches[0].clientY);
        }
        function handleTouchMove(e) { if(dragItem) { e.preventDefault(); moveItem(e.touches[0].clientX, e.touches[0].clientY); } }
        function moveItem(x,y) { dragItem.style.left=(x-tX)+'px'; dragItem.style.top=(y-tY)+'px'; }
        function handleTouchEnd(e) {
            if(!dragItem) return;
            dragItem.style.display='none';
            const el=document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            dragItem.style.display='flex';
            const slot=el?el.closest('.ghost-slot'):null;
            if(slot && !slot.hasChildNodes()) fillSlot(slot); else createDraggableOne();
            dragItem=null;
        }

        holder.addEventListener('dragover', e=>e.preventDefault());
        holder.addEventListener('drop', e=> {
            e.preventDefault(); if(e.target.classList.contains('ghost-slot')) fillSlot(e.target);
        });

        function fillSlot(slot) {
            if(isInputLocked) return;
            slot.classList.remove('ghost-slot'); slot.classList.add('unit', 'c1');
            slot.innerHTML = ''; 
            blocksPlaced++;
            speak(NUMBER_DATA[blocksPlaced][currentLang]);
            
            if (blocksPlaced === currentLevel) {
                isComplete = true; isInputLocked = true;
                setTimeout(transformCharacter, 500);
            } else setTimeout(createDraggableOne, 50);
        }

        function transformCharacter() {
            spawner.innerHTML='';
            const blocks=holder.querySelectorAll('.unit');
            const hIdx=getHeadIndex(currentLevel);
            blocks.forEach((b,i)=>{
                b.className=`unit c${currentLevel}`;
                if(i===hIdx) b.innerHTML=`<div class="face-container"><div class="eyes-row"><div class="eye"></div><div class="eye"></div></div><div class="mouth"></div></div>`;
                b.style.animation="popIn 0.5s";
            });
            const msg = SUCCESS_MESSAGES[currentLang][Math.floor(Math.random()*3)].replace("{n}", NUMBER_DATA[currentLevel][currentLang]);
            speak(msg, () => {
                nextBtn.style.display='block'; nextBtn.style.backgroundColor=NUMBER_DATA[currentLevel].color;
                nextBtn.classList.add('blink');
            });
        }

        function nextLevel() {
            if(currentLevel<MAX_LEVEL) startLevel(currentLevel+1);
            else alert(UI_TEXT[currentLang].win);
        }
    </script>
</body>
</html>
